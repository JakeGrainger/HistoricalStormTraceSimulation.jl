<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Choosing Summary Metrics · HistoricalStormTraceSimulation.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://JakeGrainger.github.io/HistoricalStormTraceSimulation.jl/tracescore/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="HistoricalStormTraceSimulation.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">HistoricalStormTraceSimulation.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../basics/">Getting Started</a></li><li><a class="tocitem" href="../types/">Internal types</a></li><li><a class="tocitem" href="../sampling/">Trace Sampling</a></li><li><a class="tocitem" href="../rescalemethods/">Rescale Methods</a></li><li class="is-active"><a class="tocitem" href>Choosing Summary Metrics</a><ul class="internal"><li><a class="tocitem" href="#Trace-Scoring"><span>Trace Scoring</span></a></li></ul></li><li><a class="tocitem" href="../docstrings/">Index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Choosing Summary Metrics</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Choosing Summary Metrics</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JakeGrainger/HistoricalStormTraceSimulation.jl/blob/master/docs/src/tracescore.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Choosing-Summary-Metrics"><a class="docs-heading-anchor" href="#Choosing-Summary-Metrics">Choosing Summary Metrics</a><a id="Choosing-Summary-Metrics-1"></a><a class="docs-heading-anchor-permalink" href="#Choosing-Summary-Metrics" title="Permalink"></a></h1><p>The choice of distance measure in the storm summary space is not always obvious. One way to choose is to pick some parametric distance (e.g. weighted Euclidean distance) and then choose the parameters by try to optimise for the performance of the simulated traces.</p><p>If we have a score for the similarity of two traces, we can try to minimise the expected score of the simulated traces against the true historical traces.</p><p>To do this, use</p><article class="docstring"><header><a class="docstring-binding" id="HistoricalStormTraceSimulation.find_best_distance" href="#HistoricalStormTraceSimulation.find_best_distance"><code>HistoricalStormTraceSimulation.find_best_distance</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">find_best_distance(D::Type{&lt;:Metric},x₀,history; lowerbounds, upperbounds, optim_kwargs=(), kwargs...)</code></pre><p>Use optim to find the best distance based on <code>score_method</code> scoring.</p><p><strong>Arguments:</strong></p><ul><li><code>D</code> the type of distance (e.g. WeightedEuclidean). Note this is the constructor for the type, not an instance!</li><li><code>x₀</code> initial parameters for the distance to start optimisation.</li><li><code>history</code> the storm history.</li><li><code>lowerbounds</code> the lower bounds for the optimisation, defaults to <code>fill(-Inf,length(x₀))</code>.</li><li><code>upperbounds</code> the upper bounds for the optimisation, defaults to <code>fill(Inf,length(x₀))</code>.</li><li><code>optim_kwargs</code>: Key word arguments to be passed to Optim.</li><li><code>kwargs</code> additional key word arguments, similar to <code>score_method</code>, but not including <code>summarymetric</code>, as this is specified by the optimisation.</li></ul><p><strong>Note:</strong></p><p>To use <code>WeightedPeriodicEuclidean</code>, you first need to select the periods <code>p</code>, and then create a constructor to fix these, e.g.</p><pre><code class="language-julia-repl hljs">julia&gt; myperiods = [Inf,Inf,360.0]
3-element Vector{Float64}:
  Inf
  Inf
 360.0

julia&gt; myperiodicdistance(w) = WeightedPeriodicEuclidean(myperiods,w)
myperiodicdistance (generic function with 1 method)</code></pre><p>Then pass <code>myperiodicdistance</code> as the argument <code>D</code> to <code>find_best_distance</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JakeGrainger/HistoricalStormTraceSimulation.jl/blob/77ea7ba76871d1539b3780903a3e5250220bfd3d/src/crossvalidation.jl#L64-L95">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="HistoricalStormTraceSimulation.expected_score" href="#HistoricalStormTraceSimulation.expected_score"><code>HistoricalStormTraceSimulation.expected_score</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">expected_score(history::StormHistory; samplemethod=1:50, rescalemethod, summarymetric::Metric=Euclidean(), interpolation_method=LinearInterpolation, tracescore::TraceScore)</code></pre><p>Compute the expected score.</p><p><strong>Arguments:</strong></p><ul><li><code>history</code>, <code>samplemethod</code>, <code>rescalemethod</code>, <code>summarymetric</code>, <code>interpolation_method</code>: see <code>sampletraces</code>.</li><li><code>tracescore</code>: Score for comparing traces.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JakeGrainger/HistoricalStormTraceSimulation.jl/blob/77ea7ba76871d1539b3780903a3e5250220bfd3d/src/crossvalidation.jl#L1-L9">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="HistoricalStormTraceSimulation.conditional_expected_score" href="#HistoricalStormTraceSimulation.conditional_expected_score"><code>HistoricalStormTraceSimulation.conditional_expected_score</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">conditional_expected_score(summary,trace,history,sampler,rescalemethod,interpolation_method,tracescore)</code></pre><p>Compute the conditional expected score of a given historical trace. A different method will be used if the trace sampler uses a uniform over the closest <code>m</code> points method (i.e. if the sampler has a <code>UnitRange</code> for its <code>samplemethod</code>).</p><p><strong>Arguments</strong></p><ul><li><code>summary</code>: The summary of a historical trace.</li><li><code>trace</code>: The corresponding trace.</li><li><code>sampler</code>: A <code>TraceSampler</code>.</li><li><code>history</code>, <code>rescalemethod</code>, <code>interpolation_method</code>: see <code>sampletraces</code></li><li><code>tracescore</code>: Score for comparing traces.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JakeGrainger/HistoricalStormTraceSimulation.jl/blob/77ea7ba76871d1539b3780903a3e5250220bfd3d/src/crossvalidation.jl#L18-L30">source</a></section></article><h2 id="Trace-Scoring"><a class="docs-heading-anchor" href="#Trace-Scoring">Trace Scoring</a><a id="Trace-Scoring-1"></a><a class="docs-heading-anchor-permalink" href="#Trace-Scoring" title="Permalink"></a></h2><p>Trace scores can be specified as a subtype of <code>TraceScore</code>. A functor should then be defined taking in two traces, which returns a measure of similarity between the two, with 0 being identical.</p><p>Provided is <code>MarginalTraceScore</code> which allows the user to define weighted sums of scores (usually metrics) applied to each variable.</p><article class="docstring"><header><a class="docstring-binding" id="HistoricalStormTraceSimulation.MarginalTraceScore" href="#HistoricalStormTraceSimulation.MarginalTraceScore"><code>HistoricalStormTraceSimulation.MarginalTraceScore</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">MarginalTraceScore(metrics::NTuple{N,Metric},weights=ones(length(metrics)))</code></pre><p>Construct a scoring method for traces based on a weighted some of marginal metrics.</p><p><strong>Arguments</strong></p><ul><li><code>metrics</code>: Should be a tuple of <code>p</code> metrics, where <code>p</code> is the number of variables in the trace of interest (not including time).</li><li><code>weights</code>: A vector of weights to be used (defaults to vector of ones).</li></ul><p><strong>Use</strong></p><p>Given a <code>MarginalTraceScore</code> called <code>mscore</code>.</p><p><code>(mscore::MarginalTraceScore)(t1::StormTrace,t2::StormTrace)</code></p><p>will compute the marginal trace score between two traces <code>t1</code> and <code>t2</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JakeGrainger/HistoricalStormTraceSimulation.jl/blob/77ea7ba76871d1539b3780903a3e5250220bfd3d/src/tracescore.jl#L3-L18">source</a></section></article><p>Convenience functions for checking compatibility are also provided:</p><article class="docstring"><header><a class="docstring-binding" id="HistoricalStormTraceSimulation.checkcompatible" href="#HistoricalStormTraceSimulation.checkcompatible"><code>HistoricalStormTraceSimulation.checkcompatible</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">checkcompatible(m::MarginalTraceScore,t::StormTrace)</code></pre><p>Check trace is compatible with MarginalTraceScore.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JakeGrainger/HistoricalStormTraceSimulation.jl/blob/77ea7ba76871d1539b3780903a3e5250220bfd3d/src/tracescore.jl#L39-L43">source</a></section><section><div><pre><code class="nohighlight hljs">checkcompatible(t1::StormTrace,t2::StormTrace)</code></pre><p>Check two traces are compatible.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JakeGrainger/HistoricalStormTraceSimulation.jl/blob/77ea7ba76871d1539b3780903a3e5250220bfd3d/src/tracescore.jl#L49-L53">source</a></section></article><h3 id="Implementing-new-trace-scores"><a class="docs-heading-anchor" href="#Implementing-new-trace-scores">Implementing new trace scores</a><a id="Implementing-new-trace-scores-1"></a><a class="docs-heading-anchor-permalink" href="#Implementing-new-trace-scores" title="Permalink"></a></h3><p>New methods can be implemented by analogy to the implementation for <code>MarginalTraceScore</code>:</p><pre><code class="language-julia hljs">struct MarginalTraceScore{T,S} &lt;: TraceScore
    metrics::T
    weights::S
    function MarginalTraceScore(metrics::NTuple{N,Metric},weights=ones(length(metrics))) where {N}
        length(metrics) == length(weights) || throw(DimensionMismatch(&quot;weights and metrics should be same length.&quot;))
        new{typeof(metrics),typeof(weights)}(metrics,weights)
    end
end

function (mscore::MarginalTraceScore)(t1::StormTrace,t2::StormTrace)
    checkcompatible(t1,t2)
    checkcompatible(mscore,t1)
    score = 0.0
    for i in eachindex(mscore.metrics)
        @views score += mscore.weights[i]*mscore.metrics[i](t1.value[:,i],t2.value[:,i])
    end
    return score
end</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../rescalemethods/">« Rescale Methods</a><a class="docs-footer-nextpage" href="../docstrings/">Index »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.15 on <span class="colophon-date" title="Saturday 2 July 2022 11:09">Saturday 2 July 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
